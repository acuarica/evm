<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>EVM Bytecode Decompiler</title>
        <link rel="icon" type="image/svg+xml" href="favicon.drawio.svg" />
        <style>
            .code,
            .loading {
                display: none;
            }
        </style>
    </head>

    <body>
        <h1>EVM Bytecode Decompiler</h1>
        <section class="contracts">
            <h2>Examples</h2>
            <ul>
                <li><a href="#0x3FDA67f7583380E67ef93072294a7fAc882FD7E7">Compound</a></li>
                <li><a href="#0x06012c8cf97BEaD5deAe237070F9587f8E7A266d">CryptoKitties</a></li>
                <li><a href="#0x89d24A6b4CcB1B6fAA2625fE562bDD9a23260359">DAI</a></li>
                <li><a href="#0x314159265dD8dbb310642f98f50C066173C1259b">ENS</a></li>
                <li>
                    <a href="#0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2">Wrapped Ether (WETH)</a>
                </li>
            </ul>
            <footer>Or put any contract address in the address bar</footer>
        </section>
        <div class="loading">
            <p>Loading...</p>
        </div>
        <div class="code">
            <pre><code id="code"></code></pre>
        </div>

        <!-- https://stackoverflow.com/questions/17341122/link-and-execute-external-javascript-file-hosted-on-github -->
        <script src="https://cdn.jsdelivr.net/gh/acuarica/evm@f88b20a/lib/EVM.js"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
            typea="application/javascript"
        ></script>

        <script>
            const provider = new ethers.providers.EtherscanProvider();
            console.debug('Ethers provider', provider);

            function getCode() {
                $('.contracts').fadeOut(function () {
                    $('.loading').fadeIn();
                });
                provider
                    .getCode(location.hash.replace('#', ''))
                    .then(code => {
                        try {
                            const evm = new EVM(code, {}, {});
                            $('#code').html(evm.decompile());
                            $('.loading').fadeOut(function () {
                                $('.code').fadeIn();
                            });
                        } catch (err) {
                            console.error(err);
                            alert(err.message);
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        alert(err.message);
                    });
            }

            $(window).on('hashchange', getCode);

            if (location.hash) {
                getCode();
            }
        </script>
    </body>
</html>
